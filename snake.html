<!doctype html>
<html>
	
<head>
  <meta charset="utf-8">
  <title>Snake</title>

	<meta name="viewport" content="width=device-width">
	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

	<script>
	$(function() {
		var gameDelay = 100;
		var columns = 50;
		var rows = 50;
		var gameOver = false;
		
		for (var r = 0; r < rows; r++) {
			
			var thisRow = $("<DIV />").addClass("row");
			
			thisRow.appendTo("#board");
			
			for (var c = 0; c < columns; c++) {
				
				$("<DIV />").addClass("cell").appendTo(thisRow);
				
			}
			
		}

		var foodOnBoard = [];
		var initSnakeLength = 5;
		var snake = [];
		var direction = newRandomNumber(0, 3);
		var nextDirection = direction;
			
		var gameLogic = function() {
			var score = null;
			
			var addTail = function(lastSegment) {
				var newSegmentX = lastSegment.x;
				var newSegmentY = lastSegment.y;
				var newSegment = { x: newSegmentX, y: newSegmentY };
	
				switch(direction) {
					case 0:
						//up
						newSegment.y += 1;
						break;
					case 1:
						//right
						newSegment.x -= 1;
						break;
					case 2:
						//down
						newSegment.y -= 1;
						break;
					case 3:
						//left
						newSegment.x += 1;
						break;
				}
				
				snake.push(newSegment);
				
				return newSegment;
			};
			
			var spawnFood = function(numOfPieces) {

				var newFood = function() {
					
					var food = { x: newRandomNumber(0, columns), y: newRandomNumber(0, rows) };
					
					var badPlace = checkCollison(food, snake) && checkCollison(food, foodOnBoard);
					
					if (!badPlace) {
						colorCell(food.x, food.y, "food");
						foodOnBoard.push(food);
					} else {
						newFood();
					}
				};
				
				for (var i = 0; i < numOfPieces; i++) {
					newFood();
				}
			};
			
			var updateScore = function() {
				$("#scoreBoard").text(snake.length);
			};
			
			var loop = function() {
				if (direction !== nextDirection) {
					direction = nextDirection;
				}
				
				var gameLoop;
				var headOfSnake = snake[0];
				var headOfSnakeX = headOfSnake.x;
				var headOfSnakeY = headOfSnake.y;
				
				var newHeadOfSnake = { x: headOfSnakeX, y: headOfSnakeY };
				
				switch(direction) {
					case 0:
						//up
						newHeadOfSnake.y -= 1;
						break;
					case 1:
						//right
						newHeadOfSnake.x += 1;
						break;
					case 2:
						//down
						newHeadOfSnake.y += 1;
						break;
					case 3:
						//left
						newHeadOfSnake.x -= 1;
						break;
				}
				
				// check if out of bounds		
				if (newHeadOfSnake.x === -1) {
					gameOver = true;
				} else {
					if (newHeadOfSnake.x === columns) {
						gameOver = true;
					}
				}
				
				if (newHeadOfSnake.y === -1) {
					gameOver = true;
				} else {
					if (newHeadOfSnake.y === rows) {
						gameOver = true;
					}
				}
				
				var snakeNoHead = snake.slice(0);
				snakeNoHead.unshift(0);
				
				var ateMyself = checkCollison(newHeadOfSnake, snakeNoHead);
				
				if (ateMyself) {
					gameOver = true;
				}
				
				if (gameOver) {
					$("#scoreBoard").text("Game over!");

					return false;
				}
				
				colorCell(newHeadOfSnake.x, newHeadOfSnake.y, "snake");
				unColorCell(snake[snake.length - 1].x, snake[snake.length - 1].y, "snake");
			
				var ateFood = checkCollison(newHeadOfSnake, foodOnBoard);
				
				if (ateFood) {
					//ate food
					
					unColorCell(newHeadOfSnake.x, newHeadOfSnake.y, "food");
					
					addTail(snake[snake.length - 1]);
										
					for (var i = 0; i < foodOnBoard.length; i++) {
						if (foodOnBoard[i].x === newHeadOfSnake.x && foodOnBoard[i].y === newHeadOfSnake.y) {
							foodOnBoard.splice(i, 1)
							break;
						}
					}
										
					spawnFood(1);
					
					updateScore();
				}
				
				snake.pop();
				snake.unshift(newHeadOfSnake);
				
			
				setTimeout(function() { loop(); }, gameDelay);
			};
			
			$(document).keyup(function(e) { 
				switch(e.keyCode) {
					case 38:
						// up
						if (direction !== 2) {
							nextDirection = 0;
						}
						break;
					case 39:
						// right
						if (direction !== 3) {
							nextDirection = 1;
						}
						break;
					case 40:
						// down
						if (direction !== 0) {
							nextDirection = 2;
						}
						break;
					case 37:
						// left
						if (direction !== 1) {
							nextDirection = 3;
						}
						break;
					default:
						break;
				}
				
			});
			
			
			var startNewGame = function() {
				$(".cell").removeClass("snake food");
				
				snake = [];
				food = [];
				
				gameOver = false;
				score = initSnakeLength;
				
				updateScore();
				
				var snakeStartingPointX = newRandomNumber(10, columns-10);
				var snakeStartingPointY = newRandomNumber(10, rows-10);
				
				var lastSegment = {x: snakeStartingPointX, y: snakeStartingPointY};
				
				for (var s = 0; s < initSnakeLength; s++) {
					
					var newSegment = addTail(lastSegment);
					colorCell(newSegment.x, newSegment.y, "snake");
					
					newSegmentX = newSegment.x;
					newSegmentY = newSegment.y;
					lastSegment = { x: newSegmentX, y: newSegmentY };
				}
				
				spawnFood(5);
				loop();
			}
			startNewGame();
			
			$(".newGame").click(function() {
				startNewGame();
			});
		
		}();
		
		
		
		function newRandomNumber(min, max) {
			return Math.floor(Math.random() * (max - min + 1)) + min;
		}
		function colorCell(x, y, theClass) {
			$(".row").eq(y).find(".cell").eq(x).addClass(theClass);
		}
		function unColorCell(x, y, theClass) {
			$(".row").eq(y).find(".cell").eq(x).removeClass(theClass);
		}
		function checkCollison(needle, haystack) {
			for (var i = 0; i < haystack.length; i++) {
				if (needle.x === haystack[i].x && needle.y === haystack[i].y) {
					return true;
				}
			}
			
			return false;
		}
	});
	</script>
	
	<style>
		#board {
			width:auto;
			height:auto;
			
		}
		.row:first-child .cell {
			border-top:3px solid #000;
		}
		.row:last-child .cell {
			border-bottom:3px solid #000;
		}
		.row {
			width:auto;
			height:10px;
		}
		.cell:first-child {
			border-left:3px solid #000;
		}
		.cell:last-child {
			border-right:3px solid #000;
		}
		
		.cell {
			width:10px;
			height:10px;
			
/*
			border-bottom:1px solid #000;
			border-right:1px solid #000;
*/
			
			display:inline-block;
		}
		
		.cell.food {
			background-color:#16ff00;
		}
		
		.cell.snake {
			background-color:#0078ff;
		}
	</style>
	
</head>

<body>
	<DIV ID="scoreBoard"></DIV>
	
	<DIV ID="board"></DIV>
	
	<a href="javascript:" class="newGame">New Game</a>
</body>
	
</html>
